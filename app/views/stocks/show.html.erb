<h1><%= @stock.label %></h1>
<hr>

<div class="row">

  <div class="col-md-6">
    <h3>Price: $<%= @stock.price %></h3>
    <p><%= @stock.description %></p>
    <div class="progress">
      <div id="token-owned-progress"
           class="progress-bar progress-bar-success"
           role="progressbar"
           aria-valuenow="<%= @stock.bid_count %>"
           aria-valuemin="0"
           aria-valuemax="<%= @stock.price %>"
           style="width: <%= @stock.percentage_complete %>%">
           <span class="sr-only"><%= @stock.percentage_complete %>% Complete</span>
      </div>
      <div id="token-progress"
           role="progressbar"
           aria-valuenow="<%= @stock.bid_count %>"
           aria-valuemin="0"
           aria-valuemax="<%= @stock.price %>"
           class="progress-bar progress-bar-warning progress-bar-striped"
           style="width: <%= @stock.percentage_complete %>%">
           <span class="sr-only"><%= @stock.percentage_complete %>% Complete</span>
      </div>
    </div>
    <%= link_to 'Back', stocks_url %><% if logged_in(@stock.owner) %> | <%= link_to 'Edit', edit_stock_path(@stock) %> <% end %>
    <button class="btn btn-bid btn-default">Bid</button>
  </div>

  <div class="col-md-6">
    <% unless @stock.photos.empty? %>
      <div id="stock-photos" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators">
          <% @stock.photos.each_with_index do |photo, i| %>
            <li data-target="#stock-photos" data-slide-to="<%= i %>" <% if i == 0 %> class="active" <% end %>></li>
          <% end %>
        </ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner" role="listbox">
          <% @stock.photos.each_with_index do |photo, i| %>
            <div class="item <% if i == 0 %>active<% end %>">
              <div style="background:url(<%= photo.image.url%>) center center;
              background-size:cover;" class="slider-size">
              </div>
            </div>
          <% end %>
        </div>

        <!-- Controls -->
        <a class="left carousel-control" href="#stock-photos" role="button" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#stock-photos" role="button" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
    <% end %>
  </div>
</div>

<script>
$(document).ready(function() {
  $('.btn-bid').on('click', function() {
    $.ajax({
      url: '<%= bid_stock_path %>',
      method: 'POST'
    }).complete(function(){
      $prog = $('#token-progress');
      var now = parseInt($prog.attr('aria-valuenow')) + 1;
      var total = $prog.attr('aria-valuemax');
      $prog.attr('aria-valuenow', now);
      $prog.css('width', (now / total * 100) + "%");
    });
  });
});
</script>
